<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Test Modal</title>
        <meta name="csrf-token" content="test-token" />

        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
        />
    </head>
    <body>
        <div class="container mt-5">
            <h2>Test Modal Debug</h2>

            <button class="btn btn-primary" onclick="testModalBasic()">
                Test Modal Basic
            </button>
            <button class="btn btn-success" onclick="testEditEmployee()">
                Test Edit Employee Function
            </button>

            <div class="mt-3">
                <h4>Console Output:</h4>
                <div
                    id="console-output"
                    style="
                        background: #f8f9fa;
                        padding: 10px;
                        border: 1px solid #ccc;
                        min-height: 200px;
                    "
                >
                    <!-- Console output will appear here -->
                </div>
            </div>
        </div>

        <!-- Modal chỉnh sửa nhân viên -->
        <div
            class="modal fade"
            id="editEmployeeModal"
            tabindex="-1"
            aria-labelledby="editEmployeeModalLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editEmployeeModalLabel">
                            <i class="fas fa-edit"></i> Chỉnh sửa thông tin nhân
                            viên
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <form id="edit-employee-form">
                            <input
                                type="hidden"
                                id="edit-employee-id"
                                name="id"
                            />

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"
                                            >Mã nhân viên</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="edit-id"
                                            disabled
                                        />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"
                                            >Họ và tên</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="edit-full-name"
                                            name="full_name"
                                            required
                                        />
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                        >
                            <i class="fas fa-times"></i> Hủy
                        </button>
                        <button type="button" class="btn btn-success">
                            <i class="fas fa-save"></i> Cập nhật
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <script>
            // Override console.log to show in page
            const originalLog = console.log;
            const originalError = console.error;

            function logToPage(message, type = "log") {
                const output = document.getElementById("console-output");
                const time = new Date().toLocaleTimeString();
                const color = type === "error" ? "red" : "blue";
                output.innerHTML += `<div style="color: ${color};">[${time}] ${message}</div>`;
                output.scrollTop = output.scrollHeight;
            }

            console.log = function (...args) {
                originalLog.apply(console, args);
                logToPage(args.join(" "), "log");
            };

            console.error = function (...args) {
                originalError.apply(console, args);
                logToPage(args.join(" "), "error");
            };

            function testModalBasic() {
                console.log("Testing basic modal functionality...");

                const modalElement =
                    document.getElementById("editEmployeeModal");
                console.log("Modal element:", modalElement);

                if (modalElement) {
                    console.log("Modal found, trying to show...");
                    const modal = new bootstrap.Modal(modalElement);
                    modal.show();
                    console.log("Modal show() called");
                } else {
                    console.error("Modal element not found!");
                }
            }

            function testEditEmployee() {
                console.log("Testing editEmployee function with mock data...");

                // Mock the editEmployee function
                const id = "TEST001";
                console.log("Edit employee called with ID:", id);

                // Mock successful response
                const response = {
                    success: true,
                    employee: {
                        id: "TEST001",
                        full_name: "Test Employee",
                        department: "marketing",
                        position: "nhân viên",
                        phone: "0123456789",
                        cccd: "123456789012",
                        gender: "Nam",
                        dependent: 0,
                        role: "nhan-vien",
                        address: "Test Address",
                    },
                };

                console.log("Mock response:", response);

                if (response.success) {
                    const employee = response.employee;
                    console.log("Employee data:", employee);

                    // Fill form fields
                    $("#edit-employee-id").val(employee.id);
                    $("#edit-id").val(employee.id);
                    $("#edit-full-name").val(employee.full_name);

                    console.log("Form fields filled, showing modal...");

                    // Show modal
                    const modalElement =
                        document.getElementById("editEmployeeModal");
                    if (modalElement) {
                        const modal = new bootstrap.Modal(modalElement);
                        modal.show();
                        console.log("Modal displayed successfully");
                    } else {
                        console.error("Modal element not found!");
                    }
                }
            }

            $(document).ready(function () {
                console.log("Document ready");
                console.log("jQuery version:", $.fn.jquery);
                console.log(
                    "Bootstrap loaded:",
                    typeof bootstrap !== "undefined"
                );
            });
        </script>
    </body>
</html>
